openapi: 3.1.0
info:
  title: Task Management API
  description: |
    A RESTful API for managing tasks with CRUD operations.

    ## Features
    - Create, read, update, and delete tasks
    - Filter tasks by status
    - Search tasks by title and description
    - Pagination support
    - Input validation with detailed error messages

    ## Authentication
    This API does not currently implement authentication.

  version: 1.0.0
  contact:
    name: API Support
  license:
    name: ISC

servers:
  - url: http://localhost:3000
    description: Local development server

tags:
  - name: Tasks
    description: Task management operations

paths:
  /api/tasks:
    get:
      tags:
        - Tasks
      summary: List all tasks
      description: Retrieve a paginated list of tasks with optional filtering by status and search text
      operationId: listTasks
      parameters:
        - name: status
          in: query
          description: Filter tasks by status
          required: false
          schema:
            type: string
            enum:
              - pending
              - in_progress
              - completed
          examples:
            pending:
              value: pending
        - name: search
          in: query
          description: Search tasks by title or description
          required: false
          schema:
            type: string
          examples:
            project:
              value: project
        - name: limit
          in: query
          description: Maximum number of tasks to return (1-100)
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          examples:
            default:
              value: 10
        - name: offset
          in: query
          description: Number of tasks to skip for pagination
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          examples:
            default:
              value: 0
      responses:
        '200':
          description: Successful response with task list
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - data
                  - pagination
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Task'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
              examples:
                withTasks:
                  summary: Response with tasks
                  value:
                    success: true
                    data:
                      - id: 1
                        title: Complete project documentation
                        description: Write comprehensive API docs
                        status: in_progress
                        createdAt: '2025-01-01T10:00:00Z'
                        updatedAt: '2025-01-02T15:30:00Z'
                      - id: 2
                        title: Review pull requests
                        description: null
                        status: pending
                        createdAt: '2025-01-02T08:00:00Z'
                        updatedAt: '2025-01-02T08:00:00Z'
                    pagination:
                      total: 2
                      limit: 10
                      offset: 0
                      hasMore: false
                emptyList:
                  summary: Empty task list
                  value:
                    success: true
                    data: []
                    pagination:
                      total: 0
                      limit: 10
                      offset: 0
                      hasMore: false
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      tags:
        - Tasks
      summary: Create a new task
      description: Create a new task with title, description, and status
      operationId: createTask
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTaskRequest'
            examples:
              minimal:
                summary: Minimal task (only title)
                value:
                  title: Buy groceries
              full:
                summary: Full task with all fields
                value:
                  title: Complete project documentation
                  description: Write comprehensive API docs with examples
                  status: in_progress
      responses:
        '201':
          description: Task created successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - data
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Task'
              examples:
                created:
                  summary: Task created
                  value:
                    success: true
                    data:
                      id: 1
                      title: Complete project documentation
                      description: Write comprehensive API docs with examples
                      status: in_progress
                      createdAt: '2025-01-01T10:00:00Z'
                      updatedAt: '2025-01-01T10:00:00Z'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/tasks/{id}:
    get:
      tags:
        - Tasks
      summary: Get a task by ID
      description: Retrieve a single task by its unique identifier
      operationId: getTaskById
      parameters:
        - $ref: '#/components/parameters/TaskId'
      responses:
        '200':
          description: Task found
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - data
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Task'
              examples:
                found:
                  summary: Task found
                  value:
                    success: true
                    data:
                      id: 1
                      title: Complete project documentation
                      description: Write comprehensive API docs
                      status: in_progress
                      createdAt: '2025-01-01T10:00:00Z'
                      updatedAt: '2025-01-02T15:30:00Z'
        '400':
          $ref: '#/components/responses/InvalidIdError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      tags:
        - Tasks
      summary: Update a task
      description: Update one or more fields of an existing task
      operationId: updateTask
      parameters:
        - $ref: '#/components/parameters/TaskId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTaskRequest'
            examples:
              updateTitle:
                summary: Update only title
                value:
                  title: Updated task title
              updateStatus:
                summary: Mark as completed
                value:
                  status: completed
              updateMultiple:
                summary: Update multiple fields
                value:
                  title: Complete project documentation
                  description: Updated description with more details
                  status: in_progress
      responses:
        '200':
          description: Task updated successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - data
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Task'
              examples:
                updated:
                  summary: Task updated
                  value:
                    success: true
                    data:
                      id: 1
                      title: Updated task title
                      description: Write comprehensive API docs
                      status: completed
                      createdAt: '2025-01-01T10:00:00Z'
                      updatedAt: '2025-01-03T09:15:00Z'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      tags:
        - Tasks
      summary: Delete a task
      description: Permanently delete a task by its ID
      operationId: deleteTask
      parameters:
        - $ref: '#/components/parameters/TaskId'
      responses:
        '200':
          description: Task deleted successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - message
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
              examples:
                deleted:
                  summary: Task deleted
                  value:
                    success: true
                    message: Task deleted successfully
        '400':
          $ref: '#/components/responses/InvalidIdError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

components:
  parameters:
    TaskId:
      name: id
      in: path
      description: Task unique identifier
      required: true
      schema:
        type: integer
        format: int32
        minimum: 1
      examples:
        one:
          value: 1

  schemas:
    Task:
      type: object
      required:
        - id
        - title
        - status
        - createdAt
        - updatedAt
      properties:
        id:
          type: integer
          format: int32
          description: Unique identifier for the task
          examples:
            - 1
        title:
          type: string
          minLength: 1
          maxLength: 200
          description: Task title
          examples:
            - Complete project documentation
        description:
          type: string
          nullable: true
          description: Detailed description of the task
          examples:
            - Write comprehensive API documentation with examples
        status:
          type: string
          enum:
            - pending
            - in_progress
            - completed
          description: Current status of the task
          examples:
            - in_progress
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the task was created
          examples:
            - '2025-01-01T10:00:00Z'
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the task was last updated
          examples:
            - '2025-01-02T15:30:00Z'

    CreateTaskRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
          description: Task title
          examples:
            - Complete project documentation
        description:
          type: string
          description: Detailed description of the task
          examples:
            - Write comprehensive API documentation
        status:
          type: string
          enum:
            - pending
            - in_progress
            - completed
          default: pending
          description: Initial status of the task
          examples:
            - pending

    UpdateTaskRequest:
      type: object
      minProperties: 1
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
          description: Updated task title
          examples:
            - Updated task title
        description:
          type: string
          description: Updated task description
          examples:
            - Updated description
        status:
          type: string
          enum:
            - pending
            - in_progress
            - completed
          description: Updated task status
          examples:
            - completed
      description: At least one field must be provided for update

    Pagination:
      type: object
      required:
        - total
        - limit
        - offset
        - hasMore
      properties:
        total:
          type: integer
          format: int32
          minimum: 0
          description: Total number of tasks matching the query
          examples:
            - 25
        limit:
          type: integer
          format: int32
          minimum: 1
          maximum: 100
          description: Maximum number of tasks returned
          examples:
            - 10
        offset:
          type: integer
          format: int32
          minimum: 0
          description: Number of tasks skipped
          examples:
            - 0
        hasMore:
          type: boolean
          description: Whether more tasks are available
          examples:
            - true

    ValidationError:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          examples:
            - false
        error:
          type: string
          examples:
            - Validation error
        details:
          type: array
          items:
            type: object
            required:
              - field
              - message
            properties:
              field:
                type: string
                description: Field that failed validation
                examples:
                  - title
              message:
                type: string
                description: Validation error message
                examples:
                  - Title is required

    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          examples:
            - false
        error:
          type: string
          description: Error message
          examples:
            - Task not found
        message:
          type: string
          description: Additional error details (dev mode only)
          examples:
            - No task found with ID 999

  responses:
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'
          examples:
            missingTitle:
              summary: Missing required field
              value:
                success: false
                error: Validation error
                details:
                  - field: title
                    message: Title is required
            invalidStatus:
              summary: Invalid enum value
              value:
                success: false
                error: Validation error
                details:
                  - field: status
                    message: "Invalid enum value. Expected 'pending' | 'in_progress' | 'completed'"
            emptyUpdate:
              summary: Empty update body
              value:
                success: false
                error: Validation error
                details:
                  - field: _root
                    message: At least one field must be provided for update

    InvalidIdError:
      description: Invalid task ID
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            invalidId:
              summary: Invalid ID format
              value:
                success: false
                error: Invalid task ID
                message: Task ID must be a positive integer

    NotFoundError:
      description: Task not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            notFound:
              summary: Task not found
              value:
                success: false
                error: Task not found

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            serverError:
              summary: Server error
              value:
                success: false
                error: Internal server error
